$(document).ready(function(){if(null!=$.validator){var e=$.validator.methods.range;$.validator.methods.range=function(t,o,n){return"checkbox"===o.type?o.checked:e()}}$("#imgModal").on("show.bs.modal",function(e){$(this).find(".img-responsive").attr("src",$(e.relatedTarget).attr("src").replace("_thumb.",".")),$(this).css("display","block");var t=$(this).find(".modal-dialog"),o=($(window).height()-t.height())/2;t.css("margin-top",o)})});var applicationModule=angular.module("application",[]),userNotificationsHub=$.connection.userNotificationsHub;$(function(){$.connection.hub.logging=!0,$.connection.hub.start()}),angular.module("application").value("userNotificationsHub",userNotificationsHub),$(function(){$('[data-toggle="popover"]').popover()}),applicationModule.controller("archivedEventsController",function(e,t,o){for(e.eventName="",e.yearList=[],i=2004;i<=(new Date).getFullYear();i++)e.yearList.push(i.toString());e.eventYear=(new Date).getFullYear().toString(),o.initializeMap("map",{zoom:4,center:{lat:40,lng:-98},mapTypeId:google.maps.MapTypeId.TERRAIN}),e.map=o.map,e.markers=o.markers,e.openInfoWindow=o.openInfoWindow,e.eventData=[],e.updateMap=function(){var n={EventName:e.eventName,EventYear:e.eventYear},a=t({method:"GET",url:"/api/Events/GetArchived",params:{filter:angular.toJson(n,!1)}});a.then(function(e){o.pushEventMarkers(e,!0)})},e.updateMap()}),applicationModule.controller("currentEventsController",function(e,t,o){o.initializeMap("map",{zoom:4,center:{lat:40,lng:-98},mapTypeId:google.maps.MapTypeId.TERRAIN}),e.map=o.map,e.markers=o.markers,e.openInfoWindow=o.openInfoWindow,e.eventData=[];var n=t.get("/api/Events/GetCurrent");n.then(function(e){o.pushEventMarkers(e,!1)})}),applicationModule.controller("hostsController",function(e,t){function o(){t({method:"GET",url:"/api/Common/GetRegions"}).then(function(t){e.regions=t.data,e.selectedRegion=$.grep(e.regions,function(t){return t.ID==e.userLocation.RegionID})[0],null==e.selectedRegion&&(e.selectedRegion=$.grep(e.regions,function(e){return"United States"==e.Name})[0]),null==e.selectedRegion&&(e.selectedRegion=e.regions[0]),e.updateStates()})}e.wantsPremium=!1,e.userLocation={Lat:40,Lng:-98,RegionID:0,StateID:0},navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){e.userLocation={Lat:n.coords.latitude,Lng:n.coords.longitude};t({method:"GET",url:"/api/Common/GetUserLocationInfo",params:{location:angular.toJson(e.userLocation,!1)}}).then(function(t){e.userLocation=t.data,o()})}):o(),e.updateStates=function(){t({method:"GET",url:"/api/Common/GetStates",params:{regionID:e.selectedRegion.ID}}).then(function(t){e.states=t.data,e.selectedStates=[e.userLocation.StateID]})},e.updateAbr=function(){var t=e.hostName.match(/\b(\w)/g);null!=t?(e.hostAbr=t.join("").toUpperCase(),e.hostShortName=t.join("").toLowerCase()):(e.hostAbr="",e.hostShortName="")}}),applicationModule.controller("userNotificationsController",function(e,t,o){t.get().then(function(t){e.boomMessage=t,e.newMessages=5}),o.client.handleUserNotification=function(t){e.boomMessage=t,e.$apply()},e.boom=function(){o.server.handleUserNotification(e.testValue)}}),applicationModule.factory("googleMap",[function(){var e,t=[],o=new google.maps.InfoWindow,n=function(t,o){e=new google.maps.Map(document.getElementById(t),o)},a=function(n){var a="EventDay"==n.Status?google.maps.Animation.BOUNCE:google.maps.Animation.DROP,i="/images/map/"+n.Status+".png",r='<div class="infoWindowContent">'+n.Name+"</div>",s=new google.maps.Marker({map:e,position:{lat:n.LocationLat,lng:n.LocationLng},animation:a,title:n.Name,icon:i,content:r});google.maps.event.addListener(s,"click",function(){o.setContent("<h2>"+s.title+"</h2>"+s.content),o.open(e,s)}),t.push(s)},i=function(e,o){if(o){for(var n=0;n<t.length;n++)t[n].setMap(null);t.length=0}for(var i in e.data)a(e.data[i])},r=function(e,t){e.preventDefault(),google.maps.event.trigger(t,"click")};return{map:e,markers:t,initializeMap:n,pushEventMarker:a,pushEventMarkers:i,openInfoWindow:r}}]),applicationModule.factory("notificationsService",function(e,t){return{get:function(){var o=t.defer();return e.get("/api/Notifications").success(o.resolve).error(o.reject),o.promise}}});